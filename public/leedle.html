<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./leedle-style.css">
    <script src="../words.js" type="text/javascript"></script>
    <script src="script.js" type="module"></script>
    <title>Document</title>
</head>

<script>
    let num_of_guesses = 6;
    let guesses_left = num_of_guesses;
    let line = 1;
    let nextLetter = 0;
    let currGuess = [];
    let theWord = WORDS[Math.floor(Math.random() * WORDS.length)];
    let wordArr = [];
    let wordIter = []
    for (i = 0; i < theWord.length; i++){
        wordArr[i] = theWord.charAt(i);
        wordIter[i] = theWord.charAt(i);
    }
    console.log(theWord);

    addEventListener("keyup", (e) => {
        if (guesses_left == 0){
            return;
        }
        let pressedKey = String(e.key);

        if (pressedKey === "Backspace" && nextLetter !== 0){
            deleteLetter();
            return;
        }

        if (pressedKey === "Enter"){
            checkGuess();
            return;
        }

        let found = pressedKey.match(/[a-z]/gi);
        if (!found  || found.length > 1){
            return;
        } else {
            insertKey(pressedKey);
        }
    });

    function insertKey(pressedKey){
        console.log(line);
        if (nextLetter === 5) {
            return;
        }
        pressedKey = pressedKey.toLowerCase();
        
        console.log("First row test");
        currentBox = document.getElementsByClassName("row" + line)[nextLetter];
        currentBox.classList.add("filled-box");
        currentBox.innerHTML = pressedKey.toUpperCase();
        nextLetter++;
        currGuess.push(pressedKey);

        // let currRow = document.querySelectorAll("#box" + `${nextLetter}` );
        // console.log(currRow);
        // let row = currRow[num_of_guesses - guesses_left];
        // // let row = document.getElementById("box" + (nextLetter));

        // row.classList.add("filled-box");

        // row.innerHTML = pressedKey.toUpperCase();
        // nextLetter++;
        // currGuess.push(pressedKey);
    

    }

    function removeKey(){
        if (nextLetter === 0){
            return;
        }

        if (document.getElementsByClassName("row" + line)[nextLetter].classList.contains("correct" || "has_letter" || "incorrect")){
            return; 
        }

        let row = document.getElementsByClassName("row" + line)[nextLetter - 1];
        row.innerHTML = "";
        row.classList.remove("filled-box");
        nextLetter--;
        currGuess.pop();
    }

    function guess() {
        if (nextLetter != 5){
            return;
        }
        
        for (i = 0; i < wordArr.length; i++){
            if (wordArr.includes(currGuess[i])){
                for (j = 0; j < wordArr.length; j++){
                    if (wordArr[j] == currGuess[i]){
                        if (i == j){
                            if (wordIter[j] == null){
                                
                            }
                            console.log("Correct Spot: " + wordArr[j] + " and " +currGuess[i]);
                            document.getElementsByClassName("row" + line)[j].classList.add("correct");
                            wordIter[j] = null;
                            break;
                        } else {
                            console.log("Wrong Spot: " + wordArr[j] + " indexes " + j + " and " + i);
                            document.getElementsByClassName("row" + line)[i].classList.add("has_letter");
                             break;
                        }
                    }
                }
            } else {
                document.getElementsByClassName("row" + line)[i].classList.add("incorrect");
            }
        }
        currGuess = [];
        line++;
        num_of_guesses--;
        nextLetter = 0;

        if (document.getElementsByClassName("row" + (line - 1))[0].classList.contains("correct") & document.getElementsByClassName("row" + (line - 1))[1].classList.contains("correct") & document.getElementsByClassName("row" + (line - 1))[2].classList.contains("correct") & document.getElementsByClassName("row" + (line - 1))[3].classList.contains("correct") & document.getElementsByClassName("row" + (line - 1))[4].classList.contains("correct") ) {
            alert("You win!")
        }
    }

</script>

<body>
    <div class="header">
        <h1>Leedle</h1>
        <h3>The Interactive Word Game</h3>
    </div>
    <div class="sheet">
        <script>
            for (i = 0; i < 30; i++){
                if (i < 5) {
                    document.write(`
                        <div id="box${i}" class="box${i} row1"></div>
                    `)
                } else if (i >= 5 && i < 10){
                    document.write(`
                        <div id="box${i}" class="box${i} row2"></div>
                    `)
                } else if (i >= 10 && i < 15){
                    document.write(`
                        <div id="box${i}" class="box${i} row3"></div>
                    `)
                } else if (i >= 15 && i < 20){
                    document.write(`
                        <div id="box${i}" class="box${i} row4"></div>
                    `)
                } else if (i >= 20 && i < 25){
                    document.write(`
                        <div id="box${i}" class="box${i} row5"></div>
                    `)
                } else if (i >= 25 && i < 30){
                    document.write(`
                        <div id="box${i}" class="box${i} row6"></div>
                    `)
                }
            }
        </script>
    </div>
    <div class="letter_sheet">
        <div class="letter_sheet_row">
            <script>
                let top_row = "qwertyuiop";
                let mid_row = "asdfghjkl";
                let bot_row = "zxcvbnm";
                for (i = 0; i < top_row.length; i++){
                    currentChar = top_row.charAt(i);
                    currentStr = currentChar.toUpperCase();
                    document.write(`
                        <button class="keyboard-button" onclick="insertKey('${currentStr}')">${currentStr}</button>
                    `)
                }
            </script>
        </div>
        <div class="letter_sheet_row">
            <script>
                for (i = 0; i < mid_row.length; i++){
                    currentChar = mid_row.charAt(i);
                    currentStr = currentChar.toUpperCase();
                    document.write(`
                        <button class="keyboard-button" onclick="insertKey('${currentStr}')">${currentStr}</button>
                    `)
                }
            </script>
        </div>
        <div class="letter_sheet_row">
            <button class="del" onclick="removeKey()" style="width: 100px">DEL</button>
            <script>
                for (i = 0; i < bot_row.length; i++){
                    currentChar = bot_row.charAt(i);
                    currentStr = currentChar.toUpperCase();
                    document.write(`
                        <button class="keyboard-button" onclick="insertKey('${currentStr}')">${currentStr}</button>
                    `)
                }
            </script>
            <button type="keyboard-button" class="enter" onclick="guess()" style="width: 150px">ENTER</button>
        </div>
    </div>
</body>
</html>