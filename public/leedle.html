<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./leedle-style.css">
    <script src="../words.js" type="text/javascript"></script>
    <script src="script.js" type="module"></script>
    <title>Document</title>
</head>

<script>
    let num_of_guesses = 6;
    let guesses_left = num_of_guesses;
    let nextLetter = 0;
    let currGuess = [];
    let theWord = WORDS[Math.floor(Math.random() * WORDS.length)];
    let wordArr = [];
    for (i = 0; i < theWord.length; i++){
        wordArr[i] = theWord.charAt(i);
    }
    console.log(theWord);

    addEventListener("keyup", (e) => {
        if (guesses_left == 0){
            return;
        }
        let pressedKey = String(e.key);

        if (pressedKey === "Backspace" && nextLetter !== 0){
            deleteLetter();
            return;
        }

        if (pressedKey === "Enter"){
            checkGuess();
            return;
        }

        let found = pressedKey.match(/[a-z]/gi);
        if (!found  || found.length > 1){
            return;
        } else {
            insertKey(pressedKey);
        }
    });

    function insertKey(pressedKey){
        if (nextLetter === 5) {
            return;
        }
        pressedKey = pressedKey.toLowerCase();
        let currRow = document.querySelectorAll("#box" + `${nextLetter}` );
        console.log(currRow);
        let row = currRow[num_of_guesses - guesses_left];
        // let row = document.getElementById("box" + (nextLetter));

        row.classList.add("filled-box");

        row.innerHTML = pressedKey.toUpperCase();
        nextLetter++;
        currGuess.push(pressedKey);
    }

    function removeKey(){
        if (nextLetter === 0){
            return;
        }

        let row = document.getElementById("box" + (nextLetter - 1));
        row.innerHTML = "";
        row.classList.remove("filled-box");
        nextLetter--;
        currGuess.pop();
    }

    function guess() {

        let boxArr = [];
        for (i = 0; i < wordArr.length; i++){
            for (j = 0; j < wordArr.length; j++){
                if (currGuess[i] == wordArr[j]){
                    if (i == j){
                        boxArr[i] = 2;
                    } else {
                        boxArr[i] = 1;
                    }
                } else {
                    boxArr[i] = 0;
                }
            }

            if (boxArr[i] == 2){
                document.getElementById("box" + i).classList.add("correct");
            } else if (boxArr[i] == 1){
                document.getElementById("box" + i).classList.add("has_letter");
            } else {
                document.getElementById("box" + i).classList.add("incorrect");
            }
        }

        console.log(boxArr);


    }

</script>

<body>
    <div class="header">
        <h1>Leedle</h1>
        <h3>The Interactive Word Game</h3>
    </div>
    <div class="sheet">
        <script>
            for (i = 0; i < 31; i++){
                if (i < 5) {
                    document.write(`
                        <div id="box${i}" class="box${i} first_row"></div>
                    `)
                } else if (i > 5 && i <= 10){
                    document.write(`
                        <div id="box${i}" class="box${i} second_row"></div>
                    `)
                } else if (i > 10 && i <= 15){
                    document.write(`
                        <div id="box${i}" class="box${i} third_row"></div>
                    `)
                } else if (i > 15 && i <= 20){
                    document.write(`
                        <div id="box${i}" class="box${i} fourth_row"></div>
                    `)
                } else if (i > 20 && i <= 25){
                    document.write(`
                        <div id="box${i}" class="box${i} fifth_row"></div>
                    `)
                } else if (i > 25 && i <= 30){
                    document.write(`
                        <div id="box${i}" class="box${i} sixth_row"></div>
                    `)
                }
            }
        </script>
    </div>
    <div class="letter_sheet">
        <div class="letter_sheet_row">
            <script>
                let top_row = "qwertyuiop";
                let mid_row = "asdfghjkl";
                let bot_row = "zxcvbnm";
                for (i = 0; i < top_row.length; i++){
                    currentChar = top_row.charAt(i);
                    currentStr = currentChar.toUpperCase();
                    document.write(`
                        <button class="keyboard-button" onclick="insertKey('${currentStr}')">${currentStr}</button>
                    `)
                }
            </script>
        </div>
        <div class="letter_sheet_row">
            <script>
                for (i = 0; i < mid_row.length; i++){
                    currentChar = mid_row.charAt(i);
                    currentStr = currentChar.toUpperCase();
                    document.write(`
                        <button class="keyboard-button" onclick="insertKey('${currentStr}')">${currentStr}</button>
                    `)
                }
            </script>
        </div>
        <div class="letter_sheet_row">
            <button class="del" onclick="removeKey()" style="width: 100px">DEL</button>
            <script>
                for (i = 0; i < bot_row.length; i++){
                    currentChar = bot_row.charAt(i);
                    currentStr = currentChar.toUpperCase();
                    document.write(`
                        <button class="keyboard-button" onclick="insertKey('${currentStr}')">${currentStr}</button>
                    `)
                }
            </script>
            <button type="keyboard-button" class="enter" onclick="guess()" style="width: 150px">ENTER</button>
        </div>
    </div>
</body>
</html>